<?xml version="1.0"?>
<launch>
  <arg name="use_sim_time" default="true"/>
  <arg name="map_path" default="$(find-pkg-share dallara_launch)/map"/>
  <arg name="vehicle_model" default="dallara"  description="vehicle model name"/>

  <!-- Global parameters -->
  <group scoped="false">
    <include file="$(find-pkg-share global_parameter_loader)/launch/global_params.launch.py">
      <arg name="use_sim_time" value="$(var use_sim_time)"/>
      <arg name="vehicle_model" value="$(var vehicle_model)"/>
    </include>
  </group>

  <!-- control -->
  <arg name="lateral_controller_mode" default="pure_pursuit"/>
  <arg name="longitudinal_controller_mode" default="pid"/>
  <node pkg="trajectory_follower_node" exec="controller_node_exe" name="trajectory_follower" output="screen">
    <param name="lateral_controller_mode" value="$(var lateral_controller_mode)"/>
    <param name="longitudinal_controller_mode" value="$(var longitudinal_controller_mode)"/>
    <param from="$(find-pkg-share autoware_launch)/config/control/common/nearest_search.param.yaml" />
    <param from="$(find-pkg-share autoware_launch)/config/control/trajectory_follower/trajectory_follower_node.param.yaml" />
    <param from="$(find-pkg-share autoware_launch)/config/control/trajectory_follower/lateral/$(var lateral_controller_mode).param.yaml" />
    <param from="$(find-pkg-share autoware_launch)/config/control/trajectory_follower/longitudinal/$(var longitudinal_controller_mode).param.yaml" />
    <remap from= "~/input/reference_trajectory" to= "/planning/scenario_planning/trajectory"/>
    <remap from= "~/input/current_odometry" to= "/localization/kinematic_state"/>
    <remap from= "~/input/current_steering" to= "/vehicle/status/steering_status"/>
    <remap from= "~/input/current_accel" to= "/localization/acceleration"/>
    <remap from= "~/input/current_operation_mode" to= "/system/operation_mode/state"/>
    <remap from= "~/output/predicted_trajectory" to= "/control/trajectory_follower/lateral/predicted_trajectory"/>
    <remap from= "~/output/lateral_diagnostic" to= "/control/trajectory_follower/lateral/diagnostic"/>
    <remap from= "~/output/slope_angle" to= "/control/trajectory_follower/longitudinal/slope_angle"/>
    <remap from= "~/output/longitudinal_diagnostic" to= "/control/trajectory_follower/longitudinal/diagnostic"/>
    <remap from= "~/output/control_cmd" to= "/control/command/control_cmd"/>
  </node>

      <!-- operation_mode -->
      <group>
        <arg name="cmd" default="ros2 topic pub /system/operation_mode/state autoware_adapi_v1_msgs/msg/OperationModeState '{
          mode: 1,
          is_autoware_control_enabled: true,
          is_in_transition: false,
          is_stop_mode_available: true,
          is_autonomous_mode_available: true,
          is_local_mode_available: true,
          is_remote_mode_available: true
          }'"/>
        <executable cmd="$(var cmd)" name="operation_mode_pub" shell="true"/>
      </group> <!-- operation_mode -->
</launch>
